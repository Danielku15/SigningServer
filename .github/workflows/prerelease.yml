name: Prerelease
on: 
  workflow_dispatch:
    inputs:
      build:
        required: true
        description: Pre Release Build Number
        type: string
jobs:
  build:
    name: Create Prerelease
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '6.0.x'
      - uses: microsoft/setup-msbuild@v1
      - run: dotnet build SigningServer.sln --configuration=Release -p:CopyToDist=true -p:BuildNumber=${{ inputs.build }} -p:IsPrerelease=true
      - run: dotnet pack SigningServer.sln --configuration=Release
      - name: Archive Server Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: SigningServer.Server
          path: |
            Dist/${{ matrix.configuration }}/SigningServer.Server/*.*
      - name: Archive Client Artifacts
        uses: actions/upload-artifact@v2
        with:
          name: SigningServer.Client
          path: |
            Dist/${{ matrix.configuration }}/SigningServer.Client/*.*
      - name: Archive Client .net Tool
        uses: actions/upload-artifact@v2
        with:
          name: SigningServer.Client.Tool
          path: |
            SigningServer.Client/bin/${{ matrix.configuration }}/*.nupkg
      - name: Publish NuGet  
        run: dotnet nuget push SigningServer.Client\bin\Release\*.nupkg -k ${{secrets.NUGET_API_KEY}} -s https://api.nuget.org/v3/index.json
